version: 2

sources:
  - name: liquidity_forecasting
    database: liquidity-forecasting      # ðŸ‘ˆ your actual GCP project ID
    schema: liquidity_forecasting        # ðŸ‘ˆ your BigQuery dataset name
    tables:
      - name: transactions_raw
        description: "Raw Plaid transactions landed from GCS (CSV)."
        loaded_at_field: ingest_ts
        freshness:
          warn_after: {count: 7, period: day}
          error_after: {count: 30, period: day}
        columns:
          - name: actual_id
            tests: [not_null, unique]
          - name: business_id
            tests: [not_null]
          - name: post_date
            tests: [not_null]
          - name: amount
            tests: [not_null]
      - name: forecast_plan_raw           # <-- NEW
        loaded_at_field: ingest_ts
        freshness:
          warn_after: {count: 1, period: day}
          error_after: {count: 2, period: day}
        columns:
          - name: forecast_id
            tests: [not_null, unique]
          - name: business_id
            tests: [not_null]
          - name: cashflow_type
            tests:
              - accepted_values:
                  values: ['AR_INVOICE','PAYROLL','AP_BILL','TAX','LOAN_PAYMENT','CREDIT_DRAW','OTHER']
          - name: direction
            tests:
              - accepted_values:
                  values: ['INFLOW','OUTFLOW']
          - name: status
            tests:
              - accepted_values:
                  values: ['PLANNED','ADJUSTED','CANCELLED']
          - name: due_date
            tests: [not_null]